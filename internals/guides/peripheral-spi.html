<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>SPI </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="SPI ">
    <meta name="generator" content="docfx ">
    <meta name="version" content="internals">
  
    <link rel="shortcut icon" href="../../images/tizen_favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/tizen.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
  
    <meta property="docfx:tocrel" content="../toc.html">
  
  
  
  </head>  <body>
    <div class="layout--main">
      <div class="container-fluid h-100 api-infra">
        <div role="main" class="article row flex-xl-nowrap h-100 body-content hide-when-search">
          <div class="col-md-3 col-xl-2 px-0 layout--column is-sidebar" id="td_docs-sidebar">

            <div class="sidenav hide-when-search">
              <div class="sidetoggle collapse d-lg-block" id="secondaryNavbar">
              </div>
            </div>
          </div>
          <div class="d-none d-xl-block col-xl-2 layout--column pl-0 is-toc" id="td_docs-toc">

            <div class="hidden-sm sideaffix toc-wrapper" role="complementary">
              <div class="bs-docs-sidebar toc-content hidden-print hidden-xs hidden-sm affix" id="affix">
              </div>
            </div>
          </div>
          <main class="col-md-9 col-xl-8 layout--column is-content">
            <div id="printableArea" class="md-content-wrapper">

              <nav id="td_docs-breadcrumb" aria-label="breadcrumb"></nav>              <section class="content wrap" id="_content" data-uid="">
<h1 id="spi">SPI</h1>

<p><a href="https://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus">SPI</a> (Serial Peripheral Interface) is a programmable interface for transferring data quickly to peripherals that require high performance.</p>
<p>The SPI protocol is a serial communication method that controls the clock signal as master and other peripherals connected to SPI as slaves. This protocol is used by peripherals, such as heart-beat pulse sensors and graphic displays, that require fast data transfer.</p>
<p><strong>Figure: SPI interface diagram</strong></p>
<p><img src="media/peri_api_spi_diagram.png" alt="SPI interface diagram"></p>
<p>The SPI is a communication method between 1 master and multiple slave devices. In the above figure:</p>
<ul>
<li>CLK (SCLK or SCK) is a simple synchronization signal and a communication clock.</li>
<li>The data flows from the master to the slave in the MOSI (Master Out Slave In) line, and from the slave to the master in the MISO (Master In Slave Out) line. Full duplex data communication is possible with 2 lines (MOSI and MISO).</li>
<li>CS (Chip Select) is a signal for selecting a slave device.</li>
</ul>
<p>SPI supports half duplex read/write and full duplex transfer.</p>
<p>To use SPI, you must set the following:</p>
<ul>
<li><p>SPI mode</p>
<p><strong>Figure: SPI modes</strong></p>
<p><img src="media/peri_api_spi_mode.png" alt="SPI modes"></p>
<p>Each of the 4 available SPI modes defines a specific combination of clock polarity (CPOL) and clock phase (CPHA).</p>
<p><strong>Table: SPI modes</strong></p>
<table>
<thead>
<tr>
<th>SPI mode</th>
<th>Polarity (CPOL)</th>
<th>Phase (CPHA)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SPI MODE 0</td>
<td>0</td>
<td>0</td>
<td>CLK (Clock) is first low and data is sampled on the rising edge of each clock pulse.</td>
</tr>
<tr>
<td>SPI MODE 1</td>
<td>0</td>
<td>1</td>
<td>CLK is first low and data is sampled on the falling edge of each clock pulse.</td>
</tr>
<tr>
<td>SPI MODE 2</td>
<td>1</td>
<td>0</td>
<td>CLK is first high and data is sampled on the falling edge of each clock pulse.</td>
</tr>
<tr>
<td>SPI MODE 3</td>
<td>1</td>
<td>1</td>
<td>CLK is first high and data is sampled on the rising edge of each clock pulse.</td>
</tr>
</tbody>
</table>
</li>
<li><p>Bit order</p>
<p>The bit order refers to the sequential order in which bytes are arranged into larger numerical values. MSB indicates that the most significant bit is transmitted first. LSB indicates that the least significant bit is transmitted first.</p>
</li>
<li><p>Bit per word</p>
<p>The bit per word refers to the number of bits to be transmitted at a time when data is exchanged with a connected slave. Normally, it is set to 8 bits per word.</p>
</li>
<li><p>Frequency</p>
<p>The frequency refers to the clock signal in Hz. Since the frequencies are different for each slave device, the applicable value must be checked from the peripheral's specification.</p>
</li>
</ul>
<h2 id="opening-and-closing-a-handle">Opening and Closing a Handle</h2>
<p>To open and close a handle:</p>
<ol>
<li><p>To open a SPI handle, create the <code>SpiDevice()</code> object:</p>
<pre><code class="lang-csharp">int bus = 2;
int chip_select = 0;
SpiDevice spi = new SpiDevice(bus, chip_select);
</code></pre>
<p>The <code>bus</code> and <code>chip_select</code> parameters required for this function must be set according to the following tables.</p>
<p><strong>Table: Raspberry Pi 3 and Raspberry Pi 4</strong></p>
<table>
<thead>
<tr>
<th>Pin name</th>
<th></th>
<th></th>
<th></th>
<th>Bus (parameter 1)</th>
<th>Chip Select (parameter 2)</th>
</tr>
</thead>
<tbody>
<tr>
<td>SPI0_MOSI</td>
<td>SPI0_MISO</td>
<td>SPI0_CLK</td>
<td>SPI0_CS0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>SPI0_MOSI</td>
<td>SPI0_MISO</td>
<td>SPI0_CLK</td>
<td>SPI0_CS1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note</strong></p>
<p>For more information on the pin names and locations, see <a href="peripheral.html#protocol">Supported Protocols</a>.</p>
</blockquote>
</li>
<li><p>To close a SPI handle that is no longer used, use the <code>SpiDevice.Close()</code> method:</p>
<pre><code class="lang-csharp">spi.Close();
</code></pre>
</li>
</ol>
<h2 id="setting-the-spi-mode">Setting the SPI Mode</h2>
<p>To set the SPI mode, use the <code>SpiDevice.Mode</code> property with 1 of the following <code>SpiMode</code> types:</p>
<ul>
<li><code>SpiMode.Mode0</code>: CLK is active high and sampled at the rising edge.</li>
<li><code>SpiMode.Mode1</code>: CLK is active high and sampled at the falling edge.</li>
<li><code>SpiMode.Mode2</code>: CLK is active low and sampled at the rising edge.</li>
<li><code>SpiMode.Mode3</code>: CLK is active low and sampled at the falling edge.</li>
</ul>
<pre><code class="lang-csharp">spi.Mode = SpiMode.Mode0;
</code></pre>
<h2 id="setting-the-bit-order">Setting the Bit Order</h2>
<p>To set the bit order, use the <code>SpiDevice.BitOrder</code> property with 1 of the following <code>BitOrder</code> types:</p>
<ul>
<li><code>BitOrder.MSB</code>: Use the most significant bit first.</li>
<li><code>BitOrder.LSB</code>: Use the least significant bit first.</li>
</ul>
<pre><code class="lang-csharp">spi.BitOrder = BitOrder.MSB;
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>The Raspberry Pi 3 and Raspberry Pi 4 boards do not support the LSB bit order.</p>
</blockquote>
<h2 id="setting-the-bits-per-word">Setting the Bits per Word</h2>
<p>To set the bits per word, use the <code>SpiDevice.BitsPerWord</code> property:</p>
<pre><code class="lang-csharp">byte bits_per_word = 8;
spi.BitsPerWord = bits_per_word;
</code></pre>
<h2 id="setting-the-frequency">Setting the Frequency</h2>
<p>To set the frequency, use the <code>SpiDevice.ClockFrequency</code> property.</p>
<p>The frequency unit is Hz.</p>
<pre><code class="lang-csharp">uint frequency = 1024;
spi.ClockFrequency  = frequency;
</code></pre>
<h2 id="reading-writing-and-transferring-data">Reading, Writing, and Transferring Data</h2>
<p>To read, write, and transfer data:</p>
<ul>
<li><p>To read data from a slave device, use the <code>SpiDevice.Read()</code> method:</p>
<pre><code class="lang-csharp">byte[] data = new byte[1];
spi.Read(data);
</code></pre>
</li>
<li><p>To write data to a slave device, use the <code>SpiDevice.Write()</code> method:</p>
<pre><code class="lang-csharp">byte[] data = {0x80};
spi.Write(data);
</code></pre>
</li>
<li><p>To exchange bytes data with a slave device, use the <code>SpiDevice.TransferSequential()</code> method:</p>
<pre><code class="lang-csharp">byte[] tx_data = {0x80, 0x01};
byte[] rx_data = new byte[2];
spi.TransferSequential(tx_data, rx_data);
</code></pre>
</li>
</ul>
</section>
            </div>
          </main>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
